{
  "session": "fix-model-gaps",
  "description": "Add missing fields to Laravel models that exist in the Azure API but are not captured in our database. Critical fields: pricing_model (for filtering spot contracts) and target_group (for filtering household vs company contracts).",
  "tasks": [
    {
      "id": "add-pricing-model-migration",
      "title": "Create migration to add pricing_model column",
      "description": "Create a Laravel migration to add the 'pricing_model' column to the electricity_contracts table. The column should be a string (varchar) that accepts values: 'Spot', 'FixedPrice', 'Hybrid'. This field is CRITICAL for properly filtering spot/pörssisähkö contracts instead of the unreliable name-matching approach. Make it nullable for backwards compatibility.",
      "status": "completed",
      "priority": 1,
      "started_at": "2026-01-20T00:00:00Z",
      "completed_at": "2026-01-20T00:05:00Z",
      "passes": true
    },
    {
      "id": "add-target-group-migration",
      "title": "Create migration to add target_group column",
      "description": "Create a Laravel migration to add the 'target_group' column to the electricity_contracts table. The column should be a string (varchar) that accepts values: 'Household', 'Company', 'Both'. This field is needed to filter consumer vs business contracts. Make it nullable for backwards compatibility.",
      "status": "completed",
      "priority": 2,
      "completed_at": "2026-01-20T00:05:00Z",
      "passes": true,
      "notes": "Combined into single migration with pricing_model"
    },
    {
      "id": "update-electricity-contract-model",
      "title": "Update ElectricityContract model with new fields",
      "description": "Update app/Models/ElectricityContract.php to add 'pricing_model' and 'target_group' to the $fillable array. No casts needed as they are simple strings.",
      "status": "completed",
      "priority": 3,
      "depends_on": ["add-pricing-model-migration", "add-target-group-migration"],
      "completed_at": "2026-01-20T00:06:00Z",
      "passes": true
    },
    {
      "id": "run-migrations",
      "title": "Run the database migrations",
      "description": "Execute 'php artisan migrate' to apply the new migrations and add the columns to the database.",
      "status": "completed",
      "priority": 4,
      "depends_on": ["add-pricing-model-migration", "add-target-group-migration"],
      "completed_at": "2026-01-20T00:07:00Z",
      "passes": true
    },
    {
      "id": "update-contract-seeder",
      "title": "Update FetchContracts command to populate new fields",
      "description": "Update the FetchContracts command to map 'Details.PricingModel' to 'pricing_model' and 'Details.TargetGroup' to 'target_group' when importing contracts.",
      "status": "completed",
      "priority": 5,
      "depends_on": ["run-migrations"],
      "completed_at": "2026-01-20T00:10:00Z",
      "passes": true,
      "notes": "Also fixed spot_futures updateOrInsert to handle composite primary key"
    },
    {
      "id": "reseed-contracts",
      "title": "Re-fetch contracts with new field data",
      "description": "Run contracts:fetch command to update existing contracts with the new pricing_model and target_group values from the API.",
      "status": "completed",
      "priority": 6,
      "depends_on": ["update-contract-seeder"],
      "completed_at": "2026-01-20T00:12:00Z",
      "passes": true,
      "notes": "488 contracts updated: 103 Spot, 74 Hybrid, 311 FixedPrice; 344 Household, 143 Company, 1 Both"
    },
    {
      "id": "update-contracts-list-filter",
      "title": "Update ContractsList to use pricing_model for spot filter",
      "description": "Update app/Livewire/ContractsList.php to filter spot contracts using the 'pricing_model' field instead of the current name-matching approach. When contractTypeFilter is 'Spot', filter by pricing_model='Spot' instead of searching for 'spot' or 'pörssi' in the name. Also add a 'Hybrid' option to contractTypes.",
      "status": "completed",
      "priority": 7,
      "depends_on": ["reseed-contracts"],
      "completed_at": "2026-01-20T00:15:00Z",
      "passes": true
    },
    {
      "id": "verify-metering-values",
      "title": "Verify metering field values match API",
      "description": "Check if the metering field values in our database match the API. The API uses 'Season' but we might have 'Seasonal'. Run a query to check unique metering values and fix if needed.",
      "status": "completed",
      "priority": 8,
      "completed_at": "2026-01-20T00:16:00Z",
      "passes": true,
      "notes": "Fixed metering type from 'Seasonal' to 'Season' in ContractsList to match API values"
    }
  ]
}
